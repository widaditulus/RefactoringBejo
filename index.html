<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 20px auto; }
        .card { background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 25px; }
        h1, h2, h3, h4 { color: #2c3e50; }
        header p { color: #555; }
        .controls, .eval-controls, .tuning-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; align-items: end; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; color: #2980b9; }
        select, input { padding: 12px; border: 1px solid #bdc3c7; border-radius: 6px; font-size: 16px; width: 100%; box-sizing: border-box; }
        button { padding: 14px 25px; background: #3498db; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        button:disabled { background: #95a5a6; cursor: not-allowed; }
        button:hover:not(:disabled) { background: #2980b9; }
        .refresh-btn { background: #27ae60; }
        .refresh-btn:hover:not(:disabled) { background: #229954; }
        .save-btn { background: #27ae60; }
        .save-btn:hover:not(:disabled) { background: #229954; }
        .reset-btn { background: #e67e22; }
        .reset-btn:hover:not(:disabled) { background: #d35400; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; display: block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { color: #e74c3c; font-weight: bold; text-align: center; margin-top: 20px; padding: 15px; background: #fadbd8; border-radius: 6px; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.95em; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #ecf0f1; }
        th { background: #2c3e50; color: white; text-align: center; }
        .tab-container { border: 1px solid #ccc; border-radius: 6px; overflow: hidden; }
        .tab-buttons { display: flex; background-color: #f1f1f1; }
        .tab-button { background-color: inherit; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 16px; font-weight: bold; color: #555; border-bottom: 3px solid transparent; }
        .tab-button:hover { background-color: #ddd; }
        .tab-button.active { background-color: #fff; color: #2980b9; border-bottom: 3px solid #2980b9; }
        .tab-content { display: none; padding: 20px; background-color: #fff; }
        .tuning-slider-container { margin-top: 15px; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.9em; font-weight: bold; margin-bottom: 5px; }
        .ai-label { color: #3498db; }
        .freq-label { color: #95a5a6; }
        input[type="range"] { width: 100%; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; }
        .tuning-guide-button { background: none; border: 1px solid #3498db; color: #3498db; padding: 5px 10px; font-size: 14px; border-radius: 5px; cursor: pointer; }
        .tuning-guide-button:hover { background: #eaf2f8; }
        .tuning-guide-content { background-color: #f8f9f9; border: 1px solid #e5e8e8; border-radius: 6px; padding: 20px; margin-top: 15px; font-size: 0.9em; }
        .tuning-guide-content h5 { margin-top: 0; color: #2980b9; }
        .tuning-guide-content ul { padding-left: 20px; list-style: none; }
        .tuning-guide-content li { margin-bottom: 15px; }
        .tuning-guide-content strong { color: #2c3e50; }
    </style>
</head>
<body>
    <div class="container">
        <header style="text-align:center;">
            <h1>AI Predictor</h1>
            <p>Sistem prediksi berbasis Artificial Intelligence.</p>
        </header>

        <div class="card">
            <h2>Prediksi Angka</h2>
            <div class="controls">
                <div class="form-group">
                    <label for="pasaran">Pasaran:</label>
                    <select id="pasaran">
                        <option value="sydney">Sydney</option>
                        <option value="sgp">SGP</option>
                        <option value="hk">HK</option>
                        <option value="china">China</option>
                        <option value="magnum">Magnum</option>
                        <option value="taiwan">Taiwan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tanggal">Tanggal Prediksi:</label>
                    <input type="date" id="tanggal">
                </div>
                <button onclick="prediksiCB()">Mulai Prediksi</button>
                <button onclick="refreshData(this)" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Muat Ulang Data
                </button>
            </div>
            <div id="data-update-info" style="font-size: 0.9em; color: #555; text-align: right; margin-top: 10px;"></div>
        </div>
        <div id="hasil" class="card" style="display: none; text-align: center;"></div>

        <div class="tab-container card">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="openTab(event, 'ManajemenModel')">Manajemen & Latih Model</button>
                <button class="tab-button" onclick="openTab(event, 'EvaluasiKinerja')">Evaluasi Kinerja</button>
            </div>

            <div id="ManajemenModel" class="tab-content" style="display: block;">
                <h3>Manajemen Model</h3>
                <div class="form-group" style="max-width: 300px; margin-bottom: 20px;">
                    <label for="pasaran-train">Pilih Pasaran untuk Dimanipulasi:</label>
                    <select id="pasaran-train">
                        <option value="sydney">Sydney</option>
                        <option value="sgp">SGP</option>
                        <option value="hk">HK</option>
                        <option value="china">China</option>
                        <option value="magnum">Magnum</option>
                        <option value="taiwan">Taiwan</option>
                    </select>
                </div>

                <div class="panel-header" style="margin-top: 20px;">
                    <h4>Panel Kontrol Tuning (Neural Network)</h4>
                    <button class="tuning-guide-button" onclick="toggleTuningGuide()">
                        <i class="fas fa-book-open"></i> Panduan Tuning
                    </button>
                </div>

                <div id="tuning-guide-content" class="tuning-guide-content" style="display: none;">
                    <h5>Panduan Cepat Parameter Tuning</h5>
                    <ul>
                        <li><strong>Epochs (Siklus Latihan):</strong><br>
                            <em>Fungsi:</em> Berapa kali model akan melihat keseluruhan dataset latihan.<br>
                            <em>Saran:</em> Semakin <strong>tinggi</strong> nilainya, semakin dalam model belajar. Namun, terlalu tinggi bisa menyebabkan <em>overfitting</em> (model terlalu hafal data lama dan buruk pada data baru).
                        </li>
                        <li><strong>Neuron Layer 1 & 2 (Kompleksitas Model):</strong><br>
                            <em>Fungsi:</em> Ibarat kapasitas "otak" AI. Menentukan seberapa kompleks pola yang bisa dipelajari.<br>
                            <em>Saran:</em> Nilai <strong>lebih besar</strong> memungkinkan model mempelajari pola yang rumit. Mulailah dengan nilai default.
                        </li>
                         <li><strong>Patience (Tingkat Kesabaran):</strong><br>
                            <em>Fungsi:</em> Jumlah <em>epochs</em> untuk menunggu perbaikan sebelum latihan dihentikan secara otomatis.<br>
                            <em>Saran:</em> Ini adalah pengaman untuk efisiensi. Jika akurasi model tidak membaik setelah (misalnya) 15 <em>epochs</em>, latihan akan berhenti untuk menghemat waktu.
                        </li>
                    </ul>
                    <p><strong>Tips:</strong> Mulai dengan mengubah pengaturan <strong>Global</strong>. Hanya ubah pengaturan spesifik posisi (AS, KOP, dll.) jika Anda ingin posisi tersebut memiliki "perilaku belajar" yang berbeda.</p>
                </div>

                <p style="font-size: 0.9em; color: #666; margin-top: 15px; margin-bottom: 15px;">Pengaturan spesifik posisi akan menimpa (override) pengaturan Global.</p>
                <div class="tuning-grid">
                     <div class="form-group"><label for="tuning-epochs-global">Epochs (Global)</label><input type="number" id="tuning-epochs-global" step="10" value="100"></div>
                     <div class="form-group"><label for="tuning-h1-global">Neuron Layer 1 (Global)</label><input type="number" id="tuning-h1-global" step="4" value="32"></div>
                     <div class="form-group"><label for="tuning-h2-global">Neuron Layer 2 (Global)</label><input type="number" id="tuning-h2-global" step="4" value="16"></div>
                     <div class="form-group"><label for="tuning-patience-global">Patience (Global)</label><input type="number" id="tuning-patience-global" step="1" value="15"></div>
                </div>
                <hr style="margin: 25px 0;">

                <button id="latih-button" onclick="latihModelTerpilih()">Latih Model Baru (v10.8)</button>
                <button id="update-weights-button" class="reset-btn" onclick="updateWeights()">Jalankan Pembelajaran Adaptif</button>
                <div id="training-status" style="text-align: center; margin-top: 20px;"></div>
            </div>

            <div id="EvaluasiKinerja" class="tab-content">
                <h2>Evaluasi Kinerja Model</h2>
                <div class="eval-controls">
                     <div class="form-group">
                        <label for="pasaran-eval">Pasaran:</label>
                        <select id="pasaran-eval">
                             <option value="sydney">Sydney</option>
                             <option value="sgp">SGP</option>
                             <option value="hk">HK</option>
                             <option value="china">China</option>
                             <option value="magnum">Magnum</option>
                             <option value="taiwan">Taiwan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tgl-awal">Dari Tanggal:</label>
                        <input type="date" id="tgl-awal">
                    </div>
                    <div class="form-group">
                        <label for="tgl-akhir">Sampai Tanggal:</label>
                        <input type="date" id="tgl-akhir">
                    </div>
                    <button onclick="evalKinerja()">Jalankan Evaluasi</button>
                </div>
                <div id="hasil-evaluasi" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>Tuning Bobot Prediksi (AI vs Frekuensi)</h2>
            <div class="form-group" style="max-width: 300px; margin-bottom: 20px;">
                <label for="pasaran-tuning">Pilih Pasaran untuk Tuning:</label>
                <select id="pasaran-tuning">
                    <option value="sydney">Sydney</option>
                    <option value="sgp">SGP</option>
                    <option value="hk">HK</option>
                    <option value="china">China</option>
                    <option value="magnum">Magnum</option>
                    <option value="taiwan">Taiwan</option>
                </select>
            </div>

            <div id="sliders-container">
                </div>

            <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center;">
                <button class="save-btn" onclick="saveWeights()">Simpan Perubahan</button>
                <button class="reset-btn" onclick="resetWeights()">Reset ke Default</button>
            </div>
        </div>

    </div>
    <script src="/main_refactored.js"></script>
</body>
</html>